# Minimal Redis config for clean container logs

# Log to stdout (Docker collects it)
logfile ""

# Use notice level to show important messages but reduce startup noise
# notice = important messages only (startup, shutdown, config changes)
# warning = only warnings and errors (very quiet)
loglevel notice

# Keep defaults for persistence; do not warn about missing config anymore

# Memory and connection stability settings
maxmemory 512mb
maxmemory-policy allkeys-lru

# Enable AOF persistence for better crash recovery
appendonly yes
appendfsync everysec

# Increase timeout for blocking operations (default 0 = no timeout)
# This prevents premature disconnects during long blocking operations
timeout 300

# TCP keepalive to detect dead connections
tcp-keepalive 60

# Reduce the risk of connection drops
tcp-backlog 511

# Ensure Redis runs as master (not replica)
# This prevents accidental replica mode that causes write errors
# If you need replica mode, comment out the line below and configure replicaof
# replicaof <masterip> <masterport>

# CRITICAL: Allow writes even if Redis becomes a replica by accident
# This prevents the "ReadOnlyError: You can't write against a read only replica" error
# In production, you should investigate WHY Redis became a replica instead of just allowing writes
replica-read-only no

# Harden against external commands forcing replica mode
rename-command SLAVEOF ""
rename-command REPLICAOF ""
